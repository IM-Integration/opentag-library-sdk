(function(){Function.prototype.bind=Function.prototype.bind||function(a){var b=this;return function(){return b.apply(a,arguments)}}})();var global=this;try{global=(0,eval)("this")||function(){return this}()||window}catch(e$$12){}global.NAMESPACE=global;global.VERSION="0.0.1";var EMPTY_FUN=function(){},UNDEF=void 0;global.APP_PATH=global.APP_PATH||"/";global.LIBRARIES_REPO_LOC=global.LIBRARIES_REPO_LOC||"/";
(function(){function a(){}function b(a,c){for(var b=g.length,d=0;d<b;d++)if(a===g[d][0])return g[d][1];g[g.length]=[a,c];return!1}function c(a,d,f,h,x){var q=!1,k=!1,n=!1,l=!1,p=!1,p=!1;d&&(q=(p=!!d.all)||d.nodes,l=p||d.win,k=p,n=d.noFunctions&&!p,void 0!==d.noOwn&&(k=!!d.noOwn),void 0!==d.noFunctions&&(n=!!d.noFunctions),void 0!==d.win&&(l=!!d.win),void 0!==d.nodes&&(q=!!d.nodes),p=!!d.copyReference);if(void 0===f||f){void 0!==f&&f--;if(!(a&&a instanceof Object))return a;if(!q){try{if(a instanceof
Node)return a}catch(z){if(a instanceof ActiveXObject&&void 0!==a.nodeType)return a}if(a===document)return a}if(!l&&(a===window||a===e))return a;q=a instanceof Array?[]:{};a instanceof Date&&(q=new Date(a));!n&&a instanceof Function&&(n=String(a).replace(/\s+/g,""),q=n.indexOf("{[nativecode]}")+14===n.length?function(){return a.apply(x||this,arguments)}:function(){return a.apply(this,arguments)});void 0===h&&(g=[],h=0);if(n=b(a,q))return n;if(q instanceof Array)for(n=0;n<a.length;n++)q[q.length]=a[n]===
a[n]?c(a[n],d,f,h+1,a):a[n];else{var n=0,t;for(t in a){if(k||a.hasOwnProperty(t))q[t]=a[t]===a[t]?c(a[t],d,f,h+1,a):a[t];n++}}d.proto&&(q.prototype=c(a.prototype,d,f,h+1,a));p&&(q.___copy_ref=a);return q}}function d(a,c,b,f,g,k,l){b=b||{};void 0===b.hasOwn&&(b.hasOwn=!0);if(!b.objectsOnly||a instanceof Object)if(void 0===b.maxDeep||b.maxDeep){void 0!==b.maxDeep&&b.maxDeep--;if(!b||!b.nodes)try{if(a instanceof Node)return}catch(n){if(a instanceof ActiveXObject&&void 0!==a.nodeType)return}if(a!==window&&
a!==e){void 0===f&&(h=[],f=0);var r;a:{for(r=0;r<f&&r<h.length;r++)if(a===h[r]){r=!0;break a}r=!1}if(!(r||(h[f]=a,g=g||a,g&&k&&g[k]!==g[k]||c(a,g,k,l)))){k=0;r="";for(var p in a){if(!b.hasOwn||a.hasOwnProperty(p))try{var z=a[p];b.track&&(r=l?l+"."+p:p);d(z,c,b,f+1,g,p,r)}catch(t){}k++}}}}}var e=null;try{e=(0,eval)("this")||function(){return this}()}catch(f){}a.global=function(){return e};a.namespace=function(b,c,d,e){b=b.split(".");var f=a.NAMESPACE_BASE||function(){return eval("this")}(),g=null,
h=null,f=d||f;for(d=0;d<b.length-1;d+=1)g=f,h=b[d],f[h]=f[h]||{},f=f[h];g=f;h=b[b.length-1];void 0!==c?void 0!==g[h]&&e||(g[h]=c):g[h]=g[h]||{};return g[h]};a.clazz=function(b,c,d,e,f){a.namespace(b,c,e,!0);"function"===typeof d&&(c.superclass=d,c.prototype=new c.superclass(f));c.prototype&&(b=b.split("."),c.prototype.CLASS_NAME=b[b.length-1],b.splice(b.length-1,1),c.prototype.PACKAGE_NAME=b.join("."));return c};a.clazz("Utils",a);a.getObjectUsingPath=function(a,b){b=b||e;for(var c=a.split("."),d=
0;d<c.length;d++)b&&c[d]&&(b=b[c[d]]);return b};a.ANON_VARS=[];a.getAnonymousAcessor=function(b){var c=a.indexInArray(b,a.ANON_VARS);-1===c&&(c=a.addToArrayIfNotExist(a.ANON_VARS,b));return"Utils.ANON_VARS["+c+"]"};a.replaceAll=function(a,b,c){return a.replace(new RegExp(b,"g"),c)};a.secureText=function(b){"string"!==typeof b&&(b+="");b=a.replaceAll(b,"<","&lt;");return b=a.replaceAll(b,">","&gt;")};a.getUrl=function(){return document.location.href};a.getQueryParam=function(b){var c,d,e,f;c=a.getUrl();
if(0<c.indexOf("?"))for(f=c.substring(c.indexOf("?")+1).split("&"),c=0,d=f.length;c<d;c+=1)if(e=f[c],0<e.indexOf("=")&&(e=e.split("="),2===e.length&&e[0]===b))return e[1];return null};a.getElementValue=function(a){return(a=document.getElementById(a))?a.textContent||a.innerText:null};var g=[];a.objectCopy=function(a,b){b=b||{};var d=c(a,b,b.maxDeep);g=[];return d};var h=[];a.traverse=function(a,b,c){d(a,b,c)};a.prepareQuotedString=function(a){return"string"===typeof a?'"'+a.replace(/\"/g,'\\"')+'"':
a};a.expressionToFunction=function(b,c){return a.gevalAndReturn("function ("+(c||"")+") {"+b+"}").result};a.defineClass=function(b,c,d){var e=b.split("."),e=a.gevalAndReturn("(function "+e[e.length-1]+"() {  if ("+b+"._CONSTRUCTOR) {    return "+b+"._CONSTRUCTOR.apply(this, arguments);  } else {    if ("+b+".superclass) {      return "+b+".superclass.apply(this, arguments);    }  }})").result;e._CONSTRUCTOR=d.CONSTRUCTOR;e.superclass=c;a.clazz(b,e,c);for(var f in d)d.hasOwnProperty(f)&&"CONSTRUCTOR"!==
f&&(e.prototype[f]=d[f]);return e};a.keys=function(a){if(a instanceof Object){if(Object.keys)return Object.keys(a);var b=[],c;for(c in a)a.hasOwnProperty(c)&&(b[b.length]=c);return b}throw"keys() called on non-object!";};a.getSrcElement=function(a){var b;a=a||window.event;a.srcElement?b=a.srcElement:a.target&&(b=a.target);return b};a.addToArrayIfNotExist=function(a,b){for(var c=0,d=!1;c<a.length;c+=1)if(a[c]===b){d=!0;break}d||(a[a.length]=b,c=-1);return c};a.indexInArray=function(a,b){for(var c=
0,d=!1;c<a.length;c++)if(a[c]===b){d=!0;break}return d?c:-1};a.removeFromArray=function(a,b){for(var c=0;c<a.length;c+=1)a[c]===b&&a.splice(c,1)};a.addClass=function(b,c){var d;try{b.classList.add(c)}catch(e){null===b.className?b.className=c:(d=b.className.split(" "),a.addToArrayIfNotExist(d,c),b.className=d.join(" "))}};a.removeClass=function(b,c){var d;try{b.classList.remove(c)}catch(e){null===b.className?b.className="":(d=b.className.split(" "),a.removeFromArray(d,c),b.className=d.join(" "))}};
a.gevalAndReturn=function(b){a.gevalAndReturn.___var_test___=void 0;a.gevalAndReturn.___var_test___error=void 0;a.geval("try{Utils.gevalAndReturn.___var_test___=("+b+");}catch(ex){Utils.gevalAndReturn.___var_test___error = ex;}");return{result:a.gevalAndReturn.___var_test___,error:a.gevalAndReturn.___var_test___error}};a.trim=function(a){try{return String(a).trim()}catch(b){return String(a).replace(/^\s+|\s+$/g,"")}};a.setIfUnset=function(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&!a.hasOwnProperty(c)&&
(a[c]=b[c])};a.geval=function(a){window&&window.execScript?window.execScript(a):e.eval.call(e,a)};var k=[],l=!1;a.bodyReady=function(a){if(l)return a&&a(),!0;if(l=!(!document.body||"complete"!==document.readyState)){for(var b=0;b<k.length;b++)try{k[b]()}catch(c){}a&&a()}else a&&k.push(a);return l};var s=e.onload;e.onload=function(b){a.bodyReady();s&&s(b)}})();
function fitTextarea(a){"textarea"===a.tagName.toLowerCase()&&(a.style.overflow="hidden",a.style.height="0px",a.scrollHeight,a.style.height=25+a.scrollHeight+"px",a.style.overflow="")}function nextNode(a){for(;!a.tagName;)a=a.nextSibling;return a}
function toggleShowSibling(a){for(var b=a.nextSibling;b&&!b.style;)b=b.nextSibling;if(b){var c=!1;b.cmNode&&"none"===b.cmNode.style.display?(b.cmNode.style.display="",c=!0):b.cmNode||"none"!==b.style.display?(b.style.display="none",b.cmNode&&(b.cmNode.style.display="none")):(b.style.display="",c=!0,"TEXTAREA"===b.tagName&&attachEditor(b),fitTextarea(b));(a=a.children[0])&&"true"===a.getAttribute("plus")&&(a.innerHTML=c?"-":"+")}}
function attachEditor(a){a.cm=CodeMirror.fromTextArea(a,{lineNumbers:!0,mode:"javascript",theme:"ambiance",tabMode:"indent",matchBrackets:!0,extraKeys:{"Ctrl-Q":function(a){a.foldCode(a.getCursor())}},foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]});a.cm.on("change",function(){a.value=a.cm.getValue()});a.cmNode=a.nextSibling}
function getParametersAndConfigForTagNode(a,b,c){var d=a.getElementsByTagName("input");a=a.reference.config;for(var e=0;e<d.length;e++){if(!b&&-1!==d[e].className.indexOf("red"))return"red";if(void 0!==d[e].pindex){var f=d[e].pindex;a.parameters[f].inputVariable=d[e].value;if(d[e].value)try{var g=qubit.opentag.Utils.gevalAndReturn(d[e].value),g=g?g.result:g;a.parameters[f].variable={value:g}}catch(h){logError("Error reading configuration"+h)}}else c||void 0===d[e].cname||(a[d[e].cname]=d[e].value)}return c?
{parameters:a.parameters}:a}function applyParametersAndConfigToTag(a,b){a.parameters=b.parameters;for(var c in b)a[c]=b[c]}function classPath(a){if(a){a=a.split(".");for(var b=0;b<a.length;b++){var c=a[b],c=c.replace(/\s+/g,"_"),c=c.replace(/[\W+]/g,"");c.match(/^\d+/)&&(c="_"+c);a[b]=c}return a.join(".").replace(/^[\.]+/g,"").replace(/[\.]+$/g,"").replace(/\.+/g,".")}return a}function getLibraryReferenceNode(a){for(;null!==a&&!a.reference;)a=a.parentNode;return a}
window.__tmp__qubit__test_page_8_=null;function extractFunctionOrString(a){var b=qubit.opentag.Utils.trim(a);return 0===b.indexOf("function")?(qubit.opentag.Utils.geval("window.__tmp__qubit__test_page_8_="+b),window.__tmp__qubit__test_page_8_):a}var IS_IE=!1;-1!==navigator.appName.indexOf("Internet Explorer")&&(IS_IE=!0);
function getXMLHttpRequest(){var a;try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{a=new XMLHttpRequest}catch(d){throw"Your browser does not support AJAX!";}}}IS_IE?window.onerror=function(){}:a.onerror=function(){};return a}
function GET(a,b,c){var d=getXMLHttpRequest();d.onreadystatechange=function(){4===d.readyState&&b(d.responseText,d)};c=void 0===c?!0:c;try{d.onerror=function(a){logError("Error while sending GET:"+a)}}catch(e){}a=fakeParam(a);d.open("GET",a,c);d.send()}
function POST(a,b,c,d){var e=getXMLHttpRequest();e.onreadystatechange=function(){4===e.readyState&&c(e.responseText,e)};d=void 0===d?!0:d;try{e.onerror=function(a){logError("Error while sending POST:"+a)}}catch(f){}a=fakeParam(a);e.open("POST",a,d);e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.send(b)}function fakeParam(a){return a&&-1!==a.lastIndexOf("?")?a+"&fparam="+(new Date).getTime()*Math.random():a+"?fparam="+(new Date).getTime()*Math.random()}
function theProgressBar(a,b){var c=!1,d=document.getElementById("progress-bar-template").innerHTML;if(c)return!1;theProgressBar.title=a;var c=!0,e=document.createElement("div");e.className="progress-bar";e.innerHTML=d;document.body.appendChild(e);e.bar=e.children[0].children[0];e.titleNode=e.bar.children[0];e.titleNode.innerHTML=theProgressBar.title;e.progress=e.bar.children[1];var f=function(){var a=b();100<=a?(e.titleNode.innerHTML=theProgressBar.title+" 100% Done.",e.progress.style.width="100%",
setTimeout(function(){c=!1;document.body.removeChild(e)},200)):(e.titleNode.innerHTML=theProgressBar.title+" "+Math.floor(a)+"%",e.progress.style.width=Math.floor(a)+"%",setTimeout(f,20))};f();return!0}
function qconsole(){this.init=function(){if(!this.initialized){this.initialized=!0;var a=document.getElementById("console-template").innerHTML;this.container=document.createElement("div");this.container.className="qconsole";this.container.innerHTML=a;this.msgContainer=this.container.children[1];document.body.appendChild(this.container);this.msgContainer.scrollTop=this.msgContainer.scrollHeight;var b=this;this.container.ondblclick=function(){info("[double click] Clearing & hiding console...");b.clear();
b.hide()}}};this.log=function(a){var b=document.getElementById("console-msg-template").innerHTML,c=document.createElement("div");c.className="msg";c.innerHTML=b;c.msg=c.children[1];c.header=c.children[0];c.msg.innerHTML=" >>> "+a;this.msgContainer.appendChild(c);this.msgContainer.scrollTop=this.msgContainer.scrollHeight};this.clear=function(){this.msgContainer.innerHTML=""};this.show=function(){qubit.opentag.Utils.addClass(this.container,"shown");qubit.opentag.Utils.removeClass(this.container,"hidden");
this.hidden=!1};this.hide=function(){qubit.opentag.Utils.removeClass(this.container,"shown");qubit.opentag.Utils.addClass(this.container,"hidden");this.hidden=!0};this.init()}
function runTagHandler(a){var b=getParametersAndConfigForTagNode(a);if("red"===b)logError("Please fill all highlighed parameter values.\n They are required for tag to run.",2E3);else{var c=APP_PATH+"getClassPath?classPath=libraries."+a.reference.PACKAGE_NAME+".local&file=UVConf.js";GET(c,function(d,e){var f=!0;200!==e.status&&(f=!1,log("UVConfig not found. Proceeding normally."));try{f&&(log("Evaluating UVConf.js from "+c),qubit.opentag.Utils.geval(d))}catch(g){error("Exception while running UVConf.js: "+
g)}finally{runTag(a,b)}})}}
function runTag(a,b){try{var c={},d=a.classReference,e=a.reference;applyParametersAndConfigToTag(c,b);var f=e.preNode.value;String(f)!==e.config.pre&&String(f)!==String(e.pre)&&(c.pre=extractFunctionOrString(f));var g=e.postNode.value;String(g)!==e.config.post&&String(g)!==String(e.post)&&(c.post=extractFunctionOrString(g));var h=e.scriptNode.value;String(h)!==e.config.script&&String(h)!==String(e.script)&&(c.script=extractFunctionOrString(h));var k=new d(c);info("triggering run() for "+k.config.name+
" ...");k.run();info("Currently executed tag instance is exposed as <pre>window.instance<pre>Please open web console to see more logs.<br/>To view library the logs run:<pre>instance.log.rePrint(5);</pre>in web console.",5E3);window.instance=k}catch(l){logError("Error while executing configuration:"+l)}}
function saveConfig(a){a=getLibraryReferenceNode(a);var b=a.reference;a=getParametersAndConfigForTagNode(a,!0,!0);for(var c=0;c<a.parameters.length;c++)a.parameters[c].variable=void 0,delete a.parameters[c].variable;a=json.serialize({parameters:a.parameters},{prettyPrint:!0});c=b.PACKAGE_NAME+".local";a=encodeURIComponent("//:include tagsdk-current.js\n"+("qubit.opentag.Utils.namespace('"+c+"');\n")+c+".Config = "+a+";");POST(APP_PATH+"saveConfig","classPath=libraries."+b.PACKAGE_NAME+".local&config="+
a,function(a,b){var c=qubit.opentag.Utils.gevalAndReturn(a);c&&c.result.ok?info("Saved"):logError(a)})}
function saveNewVersion(a,b){(b||window.event).ignoreEvent=!0;a=getLibraryReferenceNode(a);var c=a.reference,d=prompt("Please enter the name of the new version, eg 'v1'.\n\n");if(d){var d=classPath(d),e=c.PACKAGE_NAME.split(".");POST(APP_PATH+"saveNewVersion","location=libraries&classPath="+c.PACKAGE_NAME+"&version="+(e[0]+"."+e[1])+"."+d,function(a,b){var c=qubit.opentag.Utils.gevalAndReturn(a);c&&c.result.ok?(info("Created new version."),info("Rebuilding system...",1E4),rebuildAndReload()):logError("Error while creating new version: "+
a)})}}function rebuildAndReload(){if(window.buildLocationString){var a="path="+encodeURIComponent(window.buildLocationString);GET(APP_PATH+"rebuild?"+a,function(a,c){var d=qubit.opentag.Utils.gevalAndReturn(a);d&&d.result.ok?(info("System has been rebuilt for "+window.buildLocationString,1E4),info("Reloading page."),location.reload()):logError("Rebuild failed! "+a)})}}var editUVURL=LIBRARIES_REPO_LOC+"shared/templates/UVConf.js";
function editUVURLHandler(a){GET(editUVURL,function(b,c){200!==c.status?logError(b):editUV(a,b)})}function editUV(a,b){openInEditorAndCreate("libraries."+a.reference.PACKAGE_NAME+".local","UVConf.js",!0,b)}function openInEditorHandler(a){openInEditorAndCreate("libraries."+a.reference.PACKAGE_NAME,"Tag.js",!1)}
function openInEditorAndCreate(a,b,c,d){d="classPath="+a+"&file="+b+"&create="+!!c+"&data="+encodeURIComponent(d);POST(APP_PATH+"openInEditor",d,function(a,b){var c=qubit.opentag.Utils.gevalAndReturn(a);c&&c.result.ok||(logError(a),logError("Make sure that CLASSPATH of your library matches its location!"))})}
function reloadTagHandler(a){var b=qubit.opentag.Utils,c=a.reference,d=a.classReference.versionClassPath,e="classPath=libraries."+c.PACKAGE_NAME+"&file=Tag.js";reloadTests(a);POST(APP_PATH+"getClassPath",e,function(e,g){200!==g.status&&logError("Error loading tag: "+e);try{var h=getParametersAndConfigForTagNode(a,!0,!0);b.getObjectUsingPath(c.PACKAGE_NAME).Tag=void 0;qubit.opentag.Utils.geval(e);var k=b.getObjectUsingPath(c.PACKAGE_NAME+".Tag");k.versionClassPath=d;renderLibraryToNode(k,null,null,
h)}catch(l){logError("Error loading tag: "+l)}})}function cancelEvent(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}var testSuiteCodeTemplateURL=LIBRARIES_REPO_LOC+"shared/templates/TestsSuite.js";function addEditTests(a){GET(testSuiteCodeTemplateURL,function(b,c){200!==c.status?logError(b):addEditStandardTests(a,b)})}
function addEditStandardTests(a,b){if(a=getLibraryReferenceNode(a)){var c=a.reference,d=b.replace("_PACKAGE_",c.PACKAGE_NAME),d=d.replace("_TAG_",c.PACKAGE_NAME+".Tag"),e=c.PACKAGE_NAME.split(".").join("/"),d=d.replace("_TAGPATH_",e+"/Tag.js");openInEditorAndCreate("libraries."+c.PACKAGE_NAME+".local","TestsSuite.js",!0,d)}}var bddSuiteCodeTemplateURL=LIBRARIES_REPO_LOC+"shared/templates/BDDSuite.js";
function addEditDescribeTests(a){GET(bddSuiteCodeTemplateURL,function(b,c){200!=c.status?logError(b):addEditBDDTests(a,b)})}function addEditBDDTests(a,b){if(a=getLibraryReferenceNode(a)){var c=a.reference,d=b.replace("_PACKAGE_",c.PACKAGE_NAME),d=d.replace("_TAG_",c.PACKAGE_NAME+".Tag"),e=c.PACKAGE_NAME.split(".").join("/"),d=d.replace("_TAGPATH_",e+"/Tag.js");openInEditorAndCreate("libraries."+c.PACKAGE_NAME+".local","BDDSuite.js",!0,d)}}function reloadTests(a){_reloadTest(a,"BDDSuite.js")}
function _reloadTest(a,b){var c=qubit.opentag.Utils,d=a.reference;POST(APP_PATH+"getClassPath","classPath=libraries."+d.PACKAGE_NAME+".local&file="+b,function(b,f){200!==f.status&&log("Error loading test (probably no tests). "+b);try{var g=getParametersAndConfigForTagNode(a,!0,!0);try{c.getObjectUsingPath(d.PACKAGE_NAME).local.TestsSuite=void 0}catch(h){}qubit.opentag.Utils.geval(b);var k=c.getObjectUsingPath(d.PACKAGE_NAME+".Tag");renderLibraryToNode(k,null,null,g)}catch(l){log("Error loading test: "+
l)}finally{reloadBDDTests(a)}})}
function reloadBDDTests(a){var b=qubit.opentag.Utils,c=a.reference;POST(APP_PATH+"getClassPath","classPath=libraries."+c.PACKAGE_NAME+".local&file=BDDSuite.js",function(d,e){200!==e.status&&log("Error loading test (probably no tests). "+d);try{var f=getParametersAndConfigForTagNode(a,!0,!0);try{b.getObjectUsingPath(c.PACKAGE_NAME).local.BDDSuite=void 0}catch(g){}qubit.opentag.Utils.geval(d);var h=b.getObjectUsingPath(c.PACKAGE_NAME+".Tag");renderLibraryToNode(h,null,null,f)}catch(k){log("Error loading test: "+
k)}})}var testsRunning=!1;
function runAllTests(a){if(testsRunning)info("Wait for currently running tests to finish.");else{testsRunning=!0;for(var b=document.getElementsByTagName("div"),c=0,d=0,e=[],f=0;f<b.length;f++){var g=b[f];"true"===g.getAttribute("library-node")&&(++c,e.push(g))}var h=function(b){try{var f=e[b];f&&runTestsHandler(f,function(){++d;d<c&&setTimeout(function(){h(d)},5);d===c&&(testsRunning=!1,a&&a())})}catch(g){}};h(0);theProgressBar("Running test suites...",function(){return 0===d?0:d/c*100})}}
function runTestsHandler(a,b){try{var c=a.reference,d=qubit.opentag.Utils,e=d.getObjectUsingPath(c.PACKAGE_NAME+".local.TestsSuite"),f=d.getObjectUsingPath(c.PACKAGE_NAME+".local.BDDSuite"),g=function(){var c=!1;e&&!e.isFinished()?c=!0:f&&!f.isFinished&&(c=!0);if(!c){c=!1;if(f)for(var g=f.children,h=0;h<g.length;h++)if("failed"===g[h].result.status){c=!0;break}g=!1;e&&e.failedTests&&0<e.failedTests.length&&(g=!0);if(f||e)g||c?d.addClass(a,"tests-failed"):d.addClass(a,"tests-passed");b&&b()}};e||f?
(e&&runSuite(e,g),f&&runBDDSuite(f,g)):(b&&b(),d.addClass(a,"tests-notests"),log("No tests detected for "+c.config.name))}catch(h){logError("Error while executing tests suite:"+h)}}function runSuite(a,b){a?(a.onFinished=function(){b&&b()},a.run()):b&&b()}function runBDDSuite(a,b){if(a){var c=a.resultCallback;a.resultCallback=function(){c.apply(a,arguments);a.isFinished=!0;if(b)try{b()}catch(d){alert(d)}};a.execute()}else b&&(a.isFinished=!0,b())}
function toggleUVSelector(a){"Close UV Browser"===a.innerHTML?(document.getElementById("uv-selector-holder").innerHTML="",a.innerHTML="Browse UV"):(openUVVariableSelector(),a.innerHTML="Close UV Browser")}function openUVVariableSelector(){var a=document.getElementById("uv-selector-holder");a.innerHTML="";renderUVSelector(a)}var uvPopupTemplate=document.getElementById("uv-popup-template").innerHTML;
function renderUVSelector(a,b){a.innerHTML="";var c=document.createElement("div");c.innerHTML=uvPopupTemplate;a.appendChild(c);var d=c.children[0].children[1].children[0].children[0],e=c.children[0].children[2];loadUVVariables(function(){for(var a=window.UVS,c=0;c<a.length;c++)(function(a){a.onclick=function(){e.value=a.expr;e.className="result";b&&b(a.expr)}})(renderUVSelectorItemYoNode(d,a[c]))})}var uvPopupItemTemplate=document.getElementById("uv-popup-item-template").innerHTML;
function renderUVSelectorItemYoNode(a,b){var c=document.createElement("div");c.innerHTML=uvPopupItemTemplate;var d=c.children[0].children[1];c.children[0].children[0].innerHTML=b.name;d.innerHTML=b.description;c.expr=b.expression;a.appendChild(c);return c}
function loadUVVariables(a){window.UVS?a&&a(UVS):GET(LIBRARIES_REPO_LOC+"shared/bin/html/data/uv.data",function(b,c){200!==c.status&&alert("Error loading UV data: "+b);try{for(var d=b.split("\n"),e=[],f={},g=0;g<d.length;g++){var h=d[g].split("\t"),k={name:h[1],expression:h[2],description:h[3]};f[k.expression]=k;e.push(k)}window.UVS=e;window.EUVS=f;a(e)}catch(l){logError("Error loading UVs: "+l)}})}
(function(){function a(a,b){for(var c=0;c<b.length;c++)if("function"===typeof b[c]&&a instanceof b[c])return!0;return!1}function b(a,b){for(var c=0;c<b.length;c++)if(typeof a===b[c])return!0;return!1}function c(a,b){for(var c=0;c<b.length;c++)b[c]===a&&b.splice(c,1);return b}function d(a){return'"'+a.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"'}function e(a,b){return a?" "+b:b}function f(a,b,c,d,e){var f=" ";""===c&&(f="");return(c||d?0===e.length?[f,a,e.join(","),b]:[f,a,"\n",c,h,e.join(",\n"+
c+h),"\n",c,b]:[a,e.join(","),b]).join("")}var g={};g.checkIfInstanceOf=a;var h="  ",k=function(g,m,l,w,x){if(isNaN(x)||!(w>=x)){var q,B,n,r,p=!1,z,t=!0,s=!1,G=!1,H=!1,y=!1;m&&(m.prettyPrint&&(y=!0),m.raw&&(s=m.raw),m.excludedInstances&&(q=m.excludedInstances),m.excludedTypes&&(B=m.excludedTypes),m.excludedNames&&(n=m.excludedNames),m.own&&(r=m.hasOwn),m.fakeFunctions&&(G=m.fakeFunctions),m.realFunctions&&(H=m.realFunctions),m.includeFunctions&&(p=m.includeFunctions),m.excludeOnTrue&&(z=m.excludeOnTrue),
m.dateAsString&&(t=m.dateAsString));var v="",F="";if(y){for(y=0;y<w;y++)v+=h;F="\n"}if(g instanceof Date)return!s||t?d(g.toISOString()):g.valueOf();if(p||"function"!==typeof g){if("number"===typeof g)return e(v,String(g));if("string"===typeof g)return e(v,d(g));if(null===g)return e(v,"null");if(void 0===g)return s?e(v,"undefined"):void 0;if("boolean"===typeof u)return e(v,String(g));if(p&&"function"===typeof g&&G)return"(function(){})";if(p&&"function"===typeof g&&H)return e(v,g.toString());a:{if(g instanceof
Object)for(u=0;u<l.length;u++)if(l[u]===g){u=!0;break a}u=!1}if(!u){l.push(g);++w;if(g instanceof Array){n=[];for(y=0;y<g.length;y++){if(z)try{if(z(g))continue}catch(M){}if(!q||!a(g,q))if(!B||!b(g,B)){try{var C=k(g[y],m,l,w,x)}catch(J){return c(g,l),d(String(J))}void 0!==C&&n.push(C)}}c(g,l);return f("[","]",v,F,n)}var C=[],D;for(D in g){var u=g[D];if(!r||g.hasOwnProperty(D)){if(z)try{if(z(g))continue}catch(N){}if(!q||!a(u,q))if(!B||!b(u,B)){if(p=n)a:{for(p=0;p<n.length;p++)if(D===n[p]){p=!0;break a}p=
!1}if(!p)try{var I=k(u,m,l,w,x);if(void 0!==I){var K='"'+D.replace(/\"/g,'\\"')+'":'+I;C.push(K)}}catch(L){return c(g,l),d(String(L))}}}}c(g,l);return f("{","}",v,F,C)}}}};g.serialize=function(a,b){var c;b&&(c=b.level);return k(a,b,[],0,c)};var l=(0,eval("this"))||function(){return this}()||this.window;g.parse=function(a){if(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(a.replace(/"(\\.|[^"\\])*"/g,"")))throw"insecure json!";a="json.___tmp = ("+a+")";l.execScript?l.execScript(a):l.eval.call(l,a);return g.___tmp};
l.json=g;try{module.exports=g}catch(s){}})();
(function(){function a(a){a&&(this.parentContainer=a.parentContainer,this.container=a.container,this.className=a.className,this.maxTime=a.maxTime,this.closeable=a.closeable,this.init())}a.prototype.init=function(){this.container=this.container||document.createElement("div");this.container.className+=" qubit-notification "+(this.className?this.className:"")};a.prototype.drawCloseButton=function(){var a=this;this.closeable&&(this.closeButton=document.createElement("div"),0===this.container.childNodes.length?
this.container.appendChild(this.closeButton):this.container.insertBefore(this.closeButton,this.container.childNodes[0]),this.closeButton.className="notification-close-button",this.closeButton.onclick=function(){a.destroy()})};a.prototype.show=function(){this.container.style.display=""};a.prototype.hide=function(){this.container.style.display="none"};a.prototype.setContent=function(a){this.content!==a&&(this.content=a,this.container.innerHTML="","object"===typeof a?this.container.appendChild(a):this.container.innerHTML=
a,this.drawCloseButton());return a};a.prototype.paint=function(){this.painted||(this.parentContainer.appendChild(this.container),this.painted=!0)};a.prototype.destroy=function(){try{if(this.onDestroy)this.onDestroy()}finally{this.container.parentNode&&this.container.parentNode.removeChild(this.container)}};window.Notification=a})();
(function(){function a(a){a&&(this.maxTime=+a.maxTime||6E4,this.notifiers={},this.className=a.className,this.parentContainer=a.parentContainer||document.body,this.container=a.container||document.createElement("div"),this.init())}var b=window.Notification;a.prototype.notify=function(a,d,e,f,g){if(!this.notifiers[a]){e=new b({parentContainer:this.container,maxTime:e,className:f,closeable:g});var h=this;e.onDestroy=function(){delete h.notifiers[a]};this.notifiers[a]=e;e.paint()}this.notifiers[a].show();
this.notifiers[a].setContent(d);this.notifiers[a].timestamp=(new Date).valueOf()};a.prototype.done=function(a,b,e){this.notify(a,b);var f=this;setTimeout(function(){f.notifiers[a]&&(f.notifiers[a].destroy(),delete f.notifiers[a])},e)};a.prototype.init=function(){this.setParentContainer(this.parentContainer);var a=this,b;b=function(){a.container&&a.container.parentNode&&(a.oldNotifiersCheck(),setTimeout(b,500))};b()};a.prototype.setParentContainer=function(a){this.parentContainer=a;this.parentContainer.appendChild(this.container);
this.container.className.lastIndexOf(" qubit-notificationmanager"===-1)&&(this.container.className+=" qubit-notificationmanager "+this.className)};a.prototype.oldNotifiersCheck=function(){var a,b;for(a in this.notifiers)this.notifiers.hasOwnProperty(a)&&(b=this.notifiers[a].maxTime||this.maxTime,(new Date).valueOf()-this.notifiers[a].timestamp>b&&this.notifiers[a].destroy())};a.prototype.clear=function(){for(var a in this.notifiers)this.notifiers.hasOwnProperty(a)&&this.notifiers[a].destroy()};window.NotificationManager=
a})();var libraryTemplate=document.getElementById("library-template").innerHTML;
function renderLibraryToNode(a,b,c,d){d=d||{};var e=new a;e.unregister();if(d.parameters&&e.config.parameters)for(var f=0;f<d.parameters.length;f++)for(var g=d.parameters[f].token,h=0;h<e.config.parameters.length;h++)e.config.parameters[h].token===g&&(e.config.parameters[h].inputVariable=d.parameters[f].inputVariable);d=e.PACKAGE_NAME+"."+e.CLASS_NAME;b||(b=document.getElementById(d),qubit.opentag.Utils.removeClass(b,"tests-failed"),qubit.opentag.Utils.removeClass(b,"tests-passed"),qubit.opentag.Utils.removeClass(b,
"tests-notests"));b.setAttribute("library-node","true");b.innerHTML=libraryTemplate;f="";a.versionClassPath&&(f=a.prototype.PACKAGE_NAME.replace(a.versionClassPath+".",""),f=f.replace(/\._(\d)/g,".$1"),f="<span class='version-title'> ("+f+") </span>");b.children[0].children[1].innerHTML=e.config.name+f+"<a href='#-3' onclick='saveNewVersion(this, arguments[0]);'> clone </a>";qubit.opentag.Utils.addClass(b,"library");c&&qubit.opentag.Utils.addClass(b,c);b.reference=e;b.classReference=a;b.id=d;a=e.config.parameters;
c=b.children[7].children[0];b=b.children[7].children[1];try{var k=qubit.opentag.Utils.getObjectUsingPath(e.PACKAGE_NAME+".local.Config");k&&k.parameters&&_mergeParameters(a,k.parameters)}catch(l){}c.children[0].innerHTML=(e.config.imageUrl?"<img class='logo' src='"+e.config.imageUrl+"' align='right' />":"")+e.config.description;addParameters(b,a);addConfig(b,e.config);addPrePostTemplate(b,e);addTestsSuite(b,e)}
function _mergeParameters(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<b.length;e++)if(d.token&&d.token===b[e].token){var d=a[c].inputVariable,f=a[c].uv;a[c]=b[e];d&&(a[c].inputVariable=d);f&&(a[c].uv=f);break}}
function addLibrary(a,b){var c=document.createElement("div");a.appendChild(c);var d=APP_PATH+"getClassPath?classPath=libraries."+b.prototype.PACKAGE_NAME+".local&file=Config.js";try{GET(d,function(a){try{qubit.opentag.Utils.geval(a)}catch(d){}renderLibraryToNode(b,c,"hide")})}catch(e){renderLibraryToNode(b,c,"hide")}}var parameterTemplate=document.getElementById("parameter-template").innerHTML,parametersTemplate=document.getElementById("parameters-template").innerHTML;
function addParameters(a,b){var c=document.createElement("div");c.innerHTML=parametersTemplate;c.className="parameters-container";a.appendChild(c);a=c.children[1].children[0];for(var d=c.children[1].children[1],e=0;e<b.length;e++){var c=document.createElement("div"),f=b[e];c.innerHTML=parameterTemplate;var g=c.getElementsByTagName("input")[0];g.pindex=e;c.paramNode=g;c.uvNode=c.getElementsByTagName("input")[1];c.getElementsByTagName("label")[0].innerHTML=f.name+" (token: <pre style='display:inline'>"+
f.token+"</pre>)";var h=!1;f.uv?(h=!0,c.uvNode.value=f.uv):(qubit.opentag.Utils.addClass(c.uvNode,"no-uv"),c.uvNode.value="edit script to set universal variable");f=void 0!==f.inputVariable?f.inputVariable:"";g.value=f;g.className=f||h?"":"red";h&&(g.setAttribute("onfocus",null),g.setAttribute("onblur",null));a.appendChild(c)}0===b.length?(d.style.display="none",a.innerHTML="<div class='no-params'>No parameters defined.</div>"):d.style.display=""}var excluded="parameters PACKAGE dependencies CONSTRUCTOR dedupe priv name description inactive loadDependenciesOnLoad".split(" ");
function propertyExcludedFromConfig(a){for(var b=0;b<excluded.length;b++)if(a===excluded[b])return!0;return!1}var hidden=["filterTimeout","isPrivate",,"usesDocumentWrite","timeout","singleton","locationPlaceHolder","locationDetail","locationObject","noMultipleLoad","__proto__"];function propertyHiddenFromConfig(a){for(var b=0;b<hidden.length;b++)if(a===hidden[b])return!0;return!1}
function prepareConfigElement(a,b,c){var d=document.createElement("div");d.innerHTML=c;d.children[0].className="config";d.getElementsByTagName("input")[0].cname=a;d.getElementsByTagName("label")[0].innerHTML=a;void 0!==b&&(d.getElementsByTagName("input")[0].value=b);d.getElementsByTagName("input")[0].entered=!0;return d}var configTemplate=document.getElementById("config-template").innerHTML,hiddenConfigTemplate=document.getElementById("toggled-config-template").innerHTML;
function addConfig(a,b){var c=document.createElement("div");c.innerHTML=hiddenConfigTemplate;c.className="config-header";var d=c.children[0].children[0];d.innerHTML="<span plus='true'>+</span> Configuration";toggleShowSibling(d);var e=c.children[0].children[1];a.appendChild(c);for(var f in b)propertyExcludedFromConfig(f)||propertyHiddenFromConfig(f)||(d=prepareConfigElement(f,b[f],configTemplate),e.appendChild(d));c=document.createElement("div");c.innerHTML=hiddenConfigTemplate;c.className="config-header";
e.appendChild(c);d=c.children[0].children[0];e=c.children[0].children[1];toggleShowSibling(d);d.innerHTML="<span plus='true'>+</span> Advanced";for(f in b)!propertyExcludedFromConfig(f)&&propertyHiddenFromConfig(f)&&(d=prepareConfigElement(f,b[f],configTemplate),e.appendChild(d))}var prePostTemplate=document.getElementById("pre-post-script-template").innerHTML;
function addPrePostTemplate(a,b){var c=document.createElement("div");c.innerHTML=prePostTemplate;var d=c.getElementsByTagName("textarea"),e=d[0],f=d[1],d=d[2],g=b.config.post?b.config.post:String(b.post),h=b.config.script?b.config.script:String(b.script);e.value=String(b.config.pre?b.config.pre:String(b.pre));f.value=String(g);d.value=String(h);e.style.display="none";f.style.display="none";d.style.display="none";b.preNode=e;b.postNode=f;b.scriptNode=d;a.appendChild(c)}var testTemplate=document.getElementById("unit-test-template").innerHTML;
function addTest(a,b){var c=document.createElement("div");c.innerHTML=testTemplate;c.className="unit-test";b.testNode=c;b.statusNode=c.children[0];b.nameNode=c.children[1];b.nameNode.innerHTML=b.name;b.onFinished=function(){var a=qubit.opentag.Utils;this.failed?a.addClass(this.statusNode,"failed"):this.passed&&a.addClass(this.statusNode,"passed")};a.appendChild(c)}
function addBDDTest(a,b){var c=document.createElement("div");c.innerHTML=testTemplate;c.className="unit-test";b.testNode=c;b.statusNode=c.children[0];b.nameNode=c.children[1];b.nameNode.innerHTML=b.description;var d=b.resultCallback;b.resultCallback=function(a){d.apply(b,arguments);var c=qubit.opentag.Utils;"failed"===b.result.status?c.addClass(b.statusNode,"failed"):"passed"===b.result.status&&c.addClass(b.statusNode,"passed")};a.appendChild(c)}var testsSuiteTemplate=document.getElementById("unit-tests-suite-template").innerHTML;
function addTestsSuite(a,b){var c=document.createElement("div");c.className="unit-tests-suite";c.innerHTML=testsSuiteTemplate;var d=qubit.opentag.Utils,e=d.getObjectUsingPath(b.PACKAGE_NAME+".local.TestsSuite"),d=d.getObjectUsingPath(b.PACKAGE_NAME+".local.BDDSuite");a.appendChild(c);renderTestsToNode(c.children[1],e,d)}
function renderTestsToNode(a,b,c){a.innerHTML="";if(c){c.unitTestsNode=a;c=c.children;for(var d=0;d<c.length;d++)addBDDTest(a,c[d])}if(b)for(b.unitTestsNode=a,c=b.tests,d=0;d<c.length;d++)addTest(a,c[d])}function prepareVendorNode(a){var b=document.createElement("div");b.innerHTML="<a class='plain' href='#-2'>"+a+"</a>";b.className="vendor";b.children[0].onclick=function(){var a=this.ishidden?"show":"hide";this.ishidden=!this.ishidden;this.parentNode.className="vendor "+a};return b}
function findTags(a,b){b=b||[];qubit.opentag.Utils.traverse(a,function(c,d,e,f){c&&c.prototype&&"superclass"!==e&&c.prototype instanceof qubit.opentag.BaseTag&&c!==qubit.opentag.BaseTag&&c!==qubit.opentag.LibraryTag&&c!==qubit.opentag.CustomTag&&a.Tag!==c&&b.push(c)},{objectsOnly:!0,track:!0});return b}
function renderAllLibrariesToPage(){var a=document.getElementById("libraries");a.innerHTML="";var b=[],c=qubit.opentag.libraries,d;for(d in c){var e=c[d],f=prepareVendorNode(d),g;for(g in e)try{var h=e[g].Tag,k=[d,g].join(".");if(h){var l=new h({}),k=h.prototype.PACKAGE_NAME;l.unregister();l instanceof qubit.opentag.LibraryTag&&b.push([f,h,l])}for(var s=findTags(e[g]),A=0;A<s.length;A++){var m=new s[A]({});m.unregister();s[A].versionClassPath=k;b.push([f,s[A],m])}}catch(E){window.console&&console.log?
(console.log("Failed to load tag configuration, possible syntax error:"+E),info("Failed to load tag configuration, possible syntax error:"+E)):logError("Failed to load tag configuration, possible syntax error:"+E)}b.sort(function(a,b){var c=a[1],d=b[1],e=a[2].config,f=b[2].config;return e.name===f.name?(f=e="",c.versionClassPath&&(e=c.prototype.PACKAGE_NAME.replace(c.versionClassPath+".","")),d.versionClassPath&&(f=d.prototype.PACKAGE_NAME.replace(d.versionClassPath+".","")),compareVersions(e,f)):
e.name>f.name?1:e.name===f.name?0:-1});w+=b.length;a.appendChild(f)}var w=b.length,x=0;theProgressBar("Rendering...",function(){return x/w*100});var q=!1;(function(a){var b=0,c=function(){for(var d=0;8>d;d++){x++;if(b===a.length){q||setTimeout(bodyLoaded,200);q=!0;return}addLibrary(a[b][0],a[b][1]);b++}setTimeout(c,4)};c()})(b)}var total=1,counted=0;
function loadAllLibs(a){GET(LIBRARIES_REPO_LOC+"shared/bin/html/scripts.txt",function(b){var c=[];b=b.split(",");b.push("shared/bin/html/js/build-location.js");total=1;counted=0;if(!a){a=[];for(var d=0;d<b.length;d++)b[d]&&a.push(b[d])}theProgressBar("Loading scipts",function(){return 0===counted?0:counted/(a.length+total)*100});var e=0,f=function(){if(e!==a.length){var b=e;e++;var d=LIBRARIES_REPO_LOC+a[b];setTimeout(function(){_loadSingle(d,b,f,a,c)},0)}};f()})}
function compareVersions(a,b){var c=a.replace(/\./g,".").split("."),d=b.replace(/\./g,".").split("."),e=null;if(c.length&&d.length){var f=c[0].replace(/[^\d+]/g,".").split("."),f=f[f.length-1],g=d[0].replace(/[^\d+]/g,".").split("."),g=g[g.length-1],h=c[0].substring(0,c[0].lastIndexOf(f)),k=d[0].substring(0,d[0].lastIndexOf(g));h!==k||isNaN(+f)||isNaN(+g)?c[0]>d[0]?e=!0:c[0]<d[0]&&(e=!1):+f<+g?e=!0:+f>+g&&(e=!1)}if(null===e)for(f=1;f<c.length&&f<d.length;f++)if(g=d[f],h=c[f],"0"!==h.charAt(0)&&"0"!==
g.charAt(0)||0===f||(h="0."+h,g="0."+g),!isNaN(+h)&&!isNaN(+g))if(+h<+g){e=!0;break}else{if(+h>+g){e=!1;break}}else if(h<g){e=!0;break}else if(h>g){e=!1;break}c.length!==d.length&&null===e&&(e=c.length<d.length);return!0===e?1:null===e?0:-1}function _loadSingle(a,b,c,d,e){GET(a,function(f,g){try{e[b]={expr:f,url:a},log(a),counted++,d.length===counted&&_allScriptsFetched(e)}finally{c&&c()}})}
function _allScriptsFetched(a){for(var b=0;b<a.length;b++)try{eval(a[b].expr)}catch(c){logError("Failed to load: "+a[b].url+"\nException: "+c)}theProgressBar.title+=", rendering... ";listScripts();setTimeout(function(){counted++;renderAllLibrariesToPage();window.toggleConsole();qubit.opentag.Log.LEVEL=3;qubit.opentag.Log.COLLECT_LEVEL=5},50)}
function keepRunningTests(){-1!==location.href.indexOf("runTests=true")&&(info("Running tests..."),runAllTests(function(){countdown("Automatically running tests... ",10);setTimeout(keepRunningTests,1E4)}))}function countdown(a,b,c){if(!(0>=b)){info(a+b+(c||""),1E3,"countdown");var d=b-1;setTimeout(function(){countdown(a,d)},1E3)}}function listScripts(a){}function bodyLoaded(){setTimeout(keepRunningTests,1E3)}
window.Main=function(){window.qlog=new qconsole;window.toggleConsole=function(){qlog.hidden?qlog.show():qlog.hide()};window.logError=function(a,b){log("<span style='color: red'>"+a+"</span>");info("<span style='color: #FF766F'>"+a+"</span>",b||5E3)};window.info=function(a,b,c){DefaultNotificationsMgr.notify(c||(new Date).valueOf(),a,b||2800,"",!0);log(a)};window.log=function(a){qlog.log(a)};Suite.log=Test.log=function(a){log(a)};loadAllLibs();window.DefaultNotificationsMgr=new NotificationManager({maxTime:4E3})};
